<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Employee Onboarding Portal</title>

    <link rel="shortcut icon" href="#">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
          crossorigin="anonymous"/>

    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem 0;
        }

        #main {
            display: flex;
            flex-direction: column;
            padding-top: 2rem;
            background-color: #ddd;
            border-radius: 5px;
        }

        #form {
            display: flex;
            flex-direction: column;
            gap: 1rem
        }

        .form-row {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: row;
        }

        .responseMessage {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .form-label {
            width: 200px;
        }
    </style>

</head>

<body>
<div class="container" id="main">
    <div class="text-center">
        <h1 class="display-4">&#128394; Offer Position to Applicant &#128221;</h1>
        <p>On this website the hiring department can file a request to offer a position to an applicant. This triggers
            the HR
            Department to start with onboarding activities, such as getting the contract signed and adding the new
            employee to
            the internal systems.</p>
    </div>
    <div class="row justify-content-center my-5">
        <div class="col-lg-6">
            <form action="" id="form">

                <div class="form-row">
                    <label for="applicant_name" class="form-label">Applicant Name:</label>
                    <input required type="text" id="applicant_name" class="form-control"/>
                </div>

                <div class="form-row">
                    <label for="applicant_address" class="form-label">Applicant Address:</label>
                    <input required type="text" id="applicant_address" class="form-control"/>
                </div>

                <div class="form-row">
                    <label for="applicant_phone" class="form-label">Applicant PhoneNumber:</label>
                    <input required type="text" id="applicant_phone" class="form-control"/>
                </div>

                <div class="form-row">
                    <label for="position" class="form-label">Hired Position:</label>
                    <select required name="position" id="position" class="form-select">
                        <option hidden selected disabled></option>
                        <option value="Chief Procrastination Officer">Chief Procrastination Officer</option>
                        <option value="Principle Chaos Engineer">Principle Chaos Engineer</option>
                        <option value="Master of Facility Management">Master of Facility Management</option>
                    </select>
                </div>

                <div id="submit-button" class="text-center">
                    <button type="submit" class="btn btn-primary">Submit Request</button>
                </div>
                <div id="loading-button" class="text-center">
                    <button class="btn btn-primary" disabled>
                        <span class="spinner-grow spinner-grow-sm"></span>
                        Loading...
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div class="col-12">
        <div class="response"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script>
    const $loading = $('#loading-button').hide();
    const $notLoading = $('#submit-button');
    $(document)
        .ajaxStart(function () {
            $loading.show();
            $notLoading.hide();
        })
        .ajaxStop(function () {
            $notLoading.show();
            $loading.hide();
        });

    let stompClient = null;

    function connect(applicationId) {
        var socket = new SockJS('/application');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function () {
            stompClient.subscribe(`/topic/message/${applicationId}`, function (greeting) {
                $('.response').append('<div class="responseMessage"><p>' + greeting.body + '</p></div>');
            });
        });
    }

    $("#form").submit(function (event) {
        event.preventDefault();
        const data = {
            applicationId: "set-by-backend",
            applicantName: $("#applicant_name").val(),
            applicantAddress: $("#applicant_address").val(),
            applicantPhone: $("#applicant_phone").val(),
            position: $("#position").val()
        };
        $.ajax({
            method: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            url: "/application",
            data: JSON.stringify(data)
        })
            .done(function (response) {
                connect(response.applicationId);
            })
            .fail(function (jqXHR) {
                $('.response').append('<div class="responseMessage"><p>' + jqXHR.responseText + '</p></div>');
            });
    });
</script>

</body>
</html>
